{"ast":null,"code":"\"use strict\";\n\nObject.defineProperty(exports, \"__esModule\", {\n  value: true\n});\nexports.RenameOperation = void 0;\nconst collection_1 = require(\"../collection\");\nconst error_1 = require(\"../error\");\nconst utils_1 = require(\"../utils\");\nconst operation_1 = require(\"./operation\");\nconst run_command_1 = require(\"./run_command\");\n/** @internal */\nclass RenameOperation extends run_command_1.RunAdminCommandOperation {\n  constructor(collection, newName, options) {\n    // Check the collection name\n    (0, utils_1.checkCollectionName)(newName);\n    // Build the command\n    const renameCollection = collection.namespace;\n    const toCollection = collection.s.namespace.withCollection(newName).toString();\n    const dropTarget = typeof options.dropTarget === 'boolean' ? options.dropTarget : false;\n    const cmd = {\n      renameCollection: renameCollection,\n      to: toCollection,\n      dropTarget: dropTarget\n    };\n    super(collection, cmd, options);\n    this.options = options;\n    this.collection = collection;\n    this.newName = newName;\n  }\n  execute(server, session, callback) {\n    const coll = this.collection;\n    super.execute(server, session, (err, doc) => {\n      if (err) return callback(err);\n      // We have an error\n      if (doc?.errmsg) {\n        return callback(new error_1.MongoServerError(doc));\n      }\n      let newColl;\n      try {\n        newColl = new collection_1.Collection(coll.s.db, this.newName, coll.s.options);\n      } catch (err) {\n        return callback(err);\n      }\n      return callback(undefined, newColl);\n    });\n  }\n}\nexports.RenameOperation = RenameOperation;\n(0, operation_1.defineAspects)(RenameOperation, [operation_1.Aspect.WRITE_OPERATION]);","map":{"version":3,"names":["collection_1","require","error_1","utils_1","operation_1","run_command_1","RenameOperation","RunAdminCommandOperation","constructor","collection","newName","options","checkCollectionName","renameCollection","namespace","toCollection","s","withCollection","toString","dropTarget","cmd","to","execute","server","session","callback","coll","err","doc","errmsg","MongoServerError","newColl","Collection","db","undefined","exports","defineAspects","Aspect","WRITE_OPERATION"],"sources":["C:\\Users\\kin_v\\OneDrive\\Documents\\Orbital\\orbital-code\\node_modules\\mongodb\\src\\operations\\rename.ts"],"sourcesContent":["import type { Document } from '../bson';\nimport { Collection } from '../collection';\nimport { MongoServerError } from '../error';\nimport type { Server } from '../sdam/server';\nimport type { ClientSession } from '../sessions';\nimport { Callback, checkCollectionName } from '../utils';\nimport type { CommandOperationOptions } from './command';\nimport { Aspect, defineAspects } from './operation';\nimport { RunAdminCommandOperation } from './run_command';\n\n/** @public */\nexport interface RenameOptions extends CommandOperationOptions {\n  /** Drop the target name collection if it previously exists. */\n  dropTarget?: boolean;\n  /** Unclear */\n  new_collection?: boolean;\n}\n\n/** @internal */\nexport class RenameOperation extends RunAdminCommandOperation {\n  override options: RenameOptions;\n  collection: Collection;\n  newName: string;\n\n  constructor(collection: Collection, newName: string, options: RenameOptions) {\n    // Check the collection name\n    checkCollectionName(newName);\n\n    // Build the command\n    const renameCollection = collection.namespace;\n    const toCollection = collection.s.namespace.withCollection(newName).toString();\n    const dropTarget = typeof options.dropTarget === 'boolean' ? options.dropTarget : false;\n    const cmd = { renameCollection: renameCollection, to: toCollection, dropTarget: dropTarget };\n\n    super(collection, cmd, options);\n    this.options = options;\n    this.collection = collection;\n    this.newName = newName;\n  }\n\n  override execute(\n    server: Server,\n    session: ClientSession | undefined,\n    callback: Callback<Collection>\n  ): void {\n    const coll = this.collection;\n\n    super.execute(server, session, (err, doc) => {\n      if (err) return callback(err);\n      // We have an error\n      if (doc?.errmsg) {\n        return callback(new MongoServerError(doc));\n      }\n\n      let newColl: Collection<Document>;\n      try {\n        newColl = new Collection(coll.s.db, this.newName, coll.s.options);\n      } catch (err) {\n        return callback(err);\n      }\n\n      return callback(undefined, newColl);\n    });\n  }\n}\n\ndefineAspects(RenameOperation, [Aspect.WRITE_OPERATION]);\n"],"mappings":";;;;;;AACA,MAAAA,YAAA,GAAAC,OAAA;AACA,MAAAC,OAAA,GAAAD,OAAA;AAGA,MAAAE,OAAA,GAAAF,OAAA;AAEA,MAAAG,WAAA,GAAAH,OAAA;AACA,MAAAI,aAAA,GAAAJ,OAAA;AAUA;AACA,MAAaK,eAAgB,SAAQD,aAAA,CAAAE,wBAAwB;EAK3DC,YAAYC,UAAsB,EAAEC,OAAe,EAAEC,OAAsB;IACzE;IACA,IAAAR,OAAA,CAAAS,mBAAmB,EAACF,OAAO,CAAC;IAE5B;IACA,MAAMG,gBAAgB,GAAGJ,UAAU,CAACK,SAAS;IAC7C,MAAMC,YAAY,GAAGN,UAAU,CAACO,CAAC,CAACF,SAAS,CAACG,cAAc,CAACP,OAAO,CAAC,CAACQ,QAAQ,EAAE;IAC9E,MAAMC,UAAU,GAAG,OAAOR,OAAO,CAACQ,UAAU,KAAK,SAAS,GAAGR,OAAO,CAACQ,UAAU,GAAG,KAAK;IACvF,MAAMC,GAAG,GAAG;MAAEP,gBAAgB,EAAEA,gBAAgB;MAAEQ,EAAE,EAAEN,YAAY;MAAEI,UAAU,EAAEA;IAAU,CAAE;IAE5F,KAAK,CAACV,UAAU,EAAEW,GAAG,EAAET,OAAO,CAAC;IAC/B,IAAI,CAACA,OAAO,GAAGA,OAAO;IACtB,IAAI,CAACF,UAAU,GAAGA,UAAU;IAC5B,IAAI,CAACC,OAAO,GAAGA,OAAO;EACxB;EAESY,OAAOA,CACdC,MAAc,EACdC,OAAkC,EAClCC,QAA8B;IAE9B,MAAMC,IAAI,GAAG,IAAI,CAACjB,UAAU;IAE5B,KAAK,CAACa,OAAO,CAACC,MAAM,EAAEC,OAAO,EAAE,CAACG,GAAG,EAAEC,GAAG,KAAI;MAC1C,IAAID,GAAG,EAAE,OAAOF,QAAQ,CAACE,GAAG,CAAC;MAC7B;MACA,IAAIC,GAAG,EAAEC,MAAM,EAAE;QACf,OAAOJ,QAAQ,CAAC,IAAIvB,OAAA,CAAA4B,gBAAgB,CAACF,GAAG,CAAC,CAAC;;MAG5C,IAAIG,OAA6B;MACjC,IAAI;QACFA,OAAO,GAAG,IAAI/B,YAAA,CAAAgC,UAAU,CAACN,IAAI,CAACV,CAAC,CAACiB,EAAE,EAAE,IAAI,CAACvB,OAAO,EAAEgB,IAAI,CAACV,CAAC,CAACL,OAAO,CAAC;OAClE,CAAC,OAAOgB,GAAG,EAAE;QACZ,OAAOF,QAAQ,CAACE,GAAG,CAAC;;MAGtB,OAAOF,QAAQ,CAACS,SAAS,EAAEH,OAAO,CAAC;IACrC,CAAC,CAAC;EACJ;;AA5CFI,OAAA,CAAA7B,eAAA,GAAAA,eAAA;AA+CA,IAAAF,WAAA,CAAAgC,aAAa,EAAC9B,eAAe,EAAE,CAACF,WAAA,CAAAiC,MAAM,CAACC,eAAe,CAAC,CAAC"},"metadata":{},"sourceType":"script","externalDependencies":[]}